<template name="fileBrowserDialog">
    <div class="modal fade" id="fileBrowserDialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="fa fa-close"></span>
                    </button>
                    <h4 class="modal-title">Bild / Dokument wählen</h4>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="{{#if equals activePane "element"}}active{{/if}}"><a href="#" class="action-switch-source" data-value="element" role="tab">Elementordner</a></li>
                        <li role="presentation" class="{{#if equals activePane "root"}}active{{/if}}"><a href="#" class="action-switch-source" data-value="root" role="tab">Allgemeine Dateien</a></li>
                        <li role="presentation" class="{{#if equals activePane "search"}}active{{/if}}"><a href="#" class="action-switch-source" data-value="search" role="tab">Suche</a></li>
                        <li role="presentation" ><a href="#" class="action-select-nothing" role="tab">Nichts auswählen</a></li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active">
                            {{#if equals activePane "element"}}
                                {{#with fileBrowserDialogSource}}
                                    {{>fileBrowserGallery this}}
                                {{/with}}
                            {{/if}}
                            {{#if equals activePane "root"}}
                                {{>fileBrowserGallery fileRootFolder}}
                            {{/if}}
                            {{#if equals activePane "search"}}
                                {{>searchField searchType="Images" onResultClick=dialogSelection inlineResults=true}}
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template name="fileBrowser">
    <div class="container">
        {{#with curFolder}}
        <div class="row">
            <div class="col-sm-4 col-xs-12 start-content">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Verzeichnisse
                    </div>
                    <div class="panel-body">
                        {{>folderTreeItem name="Neue" _id="newest"}}
                        {{>folderTreeItem name="Verwaiste" _id="abandoned"}}
                        {{>folderTreeItem rootFolder}}
                    </div>
                </div>
            </div>
            <div class="col-sm-8 col-xs-12 start-content">
                {{#if this._id}}
                    {{#if galleryView}}
                        {{>fileBrowserGallery}}
                    {{else}}
                        {{>fileBrowserList}}
                    {{/if}}
                {{/if}}
                {{#if equals this.special "newest"}}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Neuste Dateien
                        </div>
                        <div class="list-group">
                        {{#each newFiles}}
                            {{>fileBrowserItem this}}
                        {{else}}
                        <div class="list-group-item text-center text-muted">
                            <span class="fa fa-files-o fa-3x"></span><br>
                            Keine Dateien
                        </div>
                        {{/each}}
                        </div>
                    </div>
                {{/if}}
                {{#if equals this.special "abandoned"}}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Verwaiste Dateien
                        </div>
                        <div class="list-group">
                        {{#each abandonedFiles}}
                            {{>fileBrowserItem this}}
                        {{else}}
                            <div class="list-group-item text-center text-muted">
                                <span class="fa fa-files-o fa-3x"></span><br>
                                Keine Dateien
                            </div>
                        {{/each}}
                        </div>
                    </div>
                {{/if}}
            </div>
        </div>
        {{/with}}
    </div>
</template>

<template name="fileBrowserGallery">
    {{#with folder}}
    <div class="panel panel-default">
        <div class="panel-heading element-relative">
            <div class="right-aligned-buttons">
                <button class="btn btn-default btn-new-folder">Neuer Ordner</button>
            </div>
            <span class="hidden-xs">Dateien in</span>
            {{this.name}}
        </div>
        <div class="panel-body">
            <div class="row">
            {{#with parentFolder}}
                <div class="file-browser-gallery-item">
                    <span class="fa fa-folder-o"></span>
                    <a class="folder-link" href="{{pathFor route='files' _id=this._id}}">..</a>
                </div>
            {{/with}}
            {{#each folders}}
                <div class="file-browser-gallery-item">
                    <div class="btn-group pull-right" role="group">
                      <button type="button"
                              class="btn btn-default btn-xs dropdown-toggle" data-value="{{state}}" data-toggle="dropdown" aria-expanded="false">
                         <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li><a href="#" class="rename-folder"><span class="fa fa-edit"></span> umbenennen</a></li>
                        <li><a href="#" class="remove-folder"><span class="fa fa-close"></span> löschen</a></li>
                      </ul>
                    </div>
                    <span class="fa fa-folder-o"></span>
                    {{#if rename}}
                        <input value="{{name}}" data-id="{{_id}}" class="folder-name">
                    {{else}}
                        <a class="folder-link" href="{{pathFor route='files' _id=_id}}">{{name}}</a>
                    {{/if}}
                </div>
            {{/each}}
            {{#each files}}
                {{>fileBrowserGalleryItem file=this associatedId=../_id}}
            {{/each}}
            {{#if currentUser}}
                <div class="new-gallery-item text-center">
                    Dateien hierher ziehen, um sie hochzuladen
                    <button href="#" class="btn btn-default add-file">Datei auswählen</button>
                    <form class="form" style="display:none">
                        <input type="file" class="fileInput" multiple="true">
                    </form>
                </div>
            {{/if}}
            </div>
        </div>
    </div>
    {{else}}
    Kein Dokumentenordner gewählt
    {{/with}}
</template>


<template name="fileBrowserList">
    <div class="panel panel-default">
        <div class="panel-heading">
            <button class="btn btn-default btn-sm pull-right btn-new-folder">Neuer Ordner</button>

            <span class="xs-hidden">Dateien in</span>
            {{folder.name}}
            {{#if readme}}
            <div>
                {{#markdown}}{{{readme}}}{{/markdown}}
            </div>
            {{/if}}
        </div>
        <div class="list-group">
        {{#with folder}}
            {{#with parentFolder}}
                <div class="list-group-item">
                    <div class="row">
                        <div class="col-xs-12">
                            <span class="fa fa-folder-o"></span>
                            <a class="folder-link" href="{{pathFor route='files' _id=this._id}}">..</a>
                        </div>
                    </div>
                </div>
            {{/with}}
            {{#each folders}}
            <div class="list-group-item">
                <div class="row">
                    <div class="col-sm-11 col-xs-10">
                        <span class="fa fa-folder-o"></span>
                        {{#if rename}}
                            <input value="{{name}}" data-id="{{_id}}" class="folder-name">
                        {{else}}
                            <a class="folder-link" href="{{pathFor route='files' _id=_id}}">{{name}}</a>
                        {{/if}}
                    </div>
                    <div class="col-sm-1 col-xs-2">
                        <div class="btn-group pull-right" role="group">
                          <button type="button"
                                  class="btn btn-default btn-xs dropdown-toggle" data-value="{{state}}" data-toggle="dropdown" aria-expanded="false">
                             <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="menu">
                            <li><a href="#" class="rename-folder"><span class="fa fa-edit"></span> umbenennen</a></li>
                            <li><a href="#" class="remove-folder"><span class="fa fa-close"></span> löschen</a></li>
                          </ul>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
            {{#each files}}
                {{>fileBrowserItem this}}
            {{else}}
                <div class="list-group-item">
                    {{#if Template.subscriptionsReady}}
                        {{>Empty text="Keine Dateien"}}
                    {{else}}
                        {{>Loading}}
                    {{/if}}
                </div>
            {{/each}}
            {{#if currentUser}}
            <div class="list-group-item">
                <div class="row text-center">
                    <a href="#" class="add-file">Neues Dokument anlegen</a>
                    <form class="form" style="display:none">
                        <input type="file" class="fileInput" multiple="true">
                    </form>
                </div>
            </div>
            {{/if}}
        {{/with}}
        </div>
    </div>
</template>

<template name="fileBrowserItem">
        <div class="list-group-item">
            <div class="row file-browser-item">
                <div class="col-sm-6 col-xs-12" >
                    {{#if progress}}
                        <span class="fa fa-spin fa-spinner fa-fw"></span>
                        {{progress}} % - {{name}}
                    {{else}}
                        {{#with url 32}}
                            <img src="{{this}}">
                            <a href="{{pathFor route='image' _id=../_id associated=../../../_id}}">{{../name}}</a>
                        {{else}}
                            <span class="fa {{icon}} fa-fw"></span>
                            <a href="{{url}}" target="_top">{{name}}</a>
                        {{/with}}
                    {{/if}}
                </div>
                <div class="col-sm-3 col-xs-6">
                {{formatDateTime created}}
                </div>
                <div class="col-sm-2 col-xs-4">
                {{formatFileSize size}}
                </div>
                <div class="col-sm-1 col-xs-2">
                    {{#if needsSelect}}
                        <button class="btn btn-default btn-sm select-file" title="auswählen"><span class="fa fa-check"></span></button>
                    {{else}}
                    <div class="btn-group pull-right" role="group">
                      <button type="button"
                              class="btn btn-default btn-xs dropdown-toggle" data-value="{{state}}" data-toggle="dropdown" aria-expanded="false">
                         <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li><a href="{{url}}" target="_top"><span class="fa fa-download"></span> runterladen</a></li>
                        <li><a href="#" class="edit-file"><span class="fa fa-edit"></span> bearbeiten</a></li>
                        <li><a href="#" class="remove-file"><span class="fa fa-close"></span> löschen</a></li>
                      </ul>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>
</template>


<template name="fileBrowserGalleryItem">
    <div class="file-browser-gallery-item">
        <div class="btn-group pull-right" role="group">
          <button type="button"
                  class="btn btn-default btn-sm dropdown-toggle" data-value="{{state}}" data-toggle="dropdown" aria-expanded="false">
             <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><a href="{{file.url}}" target="_top"><span class="fa fa-download"></span> runterladen</a></li>
            <li><a href="#" class="edit-file"><span class="fa fa-edit"></span> bearbeiten</a></li>
            <li><a href="#" class="remove-file"><span class="fa fa-close"></span> löschen</a></li>
              {{#each fileActions}}
              <li><a href="#" class="custom-action" > {{text}}</a></li>
              {{/each}}
          </ul>
        </div>
        
        {{#if file.progress}}
            <div class="image text-center">
                <span class="fa fa-spin fa-spinner fa-fw fa-2x"></span><br/>
                {{file.progress}} %
            </div>
        {{else}}
            {{#if file.isImage}}
            <div class="image text-center" style="background-image:url('{{file.url 160}}');">
            </div>
            {{else}}
            <div class="image text-center">
                <span class="fa {{icon}}" style="font-size:3em"></span>
            </div>
            {{/if}}
        {{/if}}
        <div class="title">
            {{file.name}}
        </div>
    </div>
</template>

<template name="folderTreeItem">
    <div class="folder-tree-item">
        {{#if isSelectedFolder}}
        <span class='fa fa-folder-open-o'></span>
        {{else}}
        <span class='fa fa-folder-o'></span>
        {{/if}}
        <a href="{{pathFor route='files' _id=_id}}">{{name}}</a>
        {{#each folders}}
            {{>folderTreeItem}}
        {{/each}}
    </div>
</template>

<template name="fileList">
    {{#each images}}
    <li><a href="#">
        {{>fileItem}}
    </a></li>
    {{/each}}
    {{#each documents}}
    <li><a href="#">
        {{>fileItem}}
    </a></li>
    {{/each}}
</template>

<template name="fileItem">
    <strong class="list-group-item-heading"><a href="{{this.url}}" target="_top">{{name}}</a></strong>
        <div class="list-group-item-text small">{{type}} {{formatFileSize size}} {{formatDateTime created}} {{fileVersions}}</div>
</template>

<template name="editFileDialog">
    <div class="modal fade" id="editFileDialog">
        <div class="modal-dialog">
            <div class="modal-content">
                {{#with file}}
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="fa fa-close"></span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        {{original.name}}
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xs-12 col-sm-6" style="background-image:url('{{url 800}}');background-size:contain;font-size:14em">
                                {{#if url 32}}
                                &nbsp;
                                {{else}}
                                <span class="fa {{icon}}"></span>
                                {{/if}}
                            </div>
                            <div class="col-xs-12 col-sm-6 form">
                                <div class="form-group">
                                    <label>Typ</label>
                                    <div class="form-control-static">{{type}}</div>
                                </div>
                                <div class="form-group">
                                    <label>Größe</label>
                                    <div class="form-control-static">{{formatFileSize size}}</div>
                                </div>
                                <div class="form-group">
                                    <label>Geändert am</label>
                                    <div class="form-control-static">{{formatDateTime created}} </div>
                                </div>
                                <div class="form-group">
                                    <label>Erstellt von</label>
                                    <div class="form-control-static">{{getAlias creator}}</div>
                                </div>
                                <div class="form-group">
                                    <label>Tags</label>
                                    <div class="form-control-static">{{#each tags}} {{this}} {{/each}}</div>
                                </div>
                                <div class="form-group">
                                    <label>Club</label>
                                    <div class="form-control-static">{{club}}</div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <label>Assoziert mit</label>
                                {{#each assozierteElemente}}
                                    <div>{{typ}}:<a href="{{link}}">{{text}}</a></div>
                                {{/each}}
                            </div>
                        </div>
                    </div>
                </div>
                {{/with}}
            </div>
        </div>
    </div>
</template>
