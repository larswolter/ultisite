<template name="header">
	{{#if preHeader}} {{>Template.dynamic template=preHeader }} {{/if}}
	<nav class="navbar navbar-default navbar-fixed-top">
		{{#unless screenSizeMobile}}
			<div class="title-image hidden-xs" style="{{settings.titleImageHeight}}px">
				<div style="background-image:url('{{imageUrl settings.imageTitleImage}}')"> </div>
				<img src="{{imageUrl settings.imageLogo}}" />
			</div>
		{{/unless}}

		<div class="container-fluid">
			{{#if currentUser}}
				<div class="hidden-xs pull-right">
					{{>userHeader}}
				</div>
				{{#if getPageSearch}}
					<div class="navbar-search-field pull-right">
						{{>searchField searchType=getPageSearch}}
					</div>
				{{else}}
					<div class="navbar-search-field pull-right">
						{{>searchField searchType="Users,Images,Tournaments,Documents,WikiPages,Blogs"}}
					</div>
				{{/if}}
			{{else}}
				<div class="pull-right">
					{{>userHeader}}
				</div>
			{{/if}}
			<div class="navbar-header">
				{{#unless currentUser}}
					<div class="visible-xs pull-right">

					</div>
				{{/unless}}
				<button type="button" class="btn navbar-btn btn-default pull-left action-toggle-sidebar visible-xs">
                    <span class="{{#unless meteorStatus.connected}}text-danger{{else}}{{#if AdminNotifications.count}}text-info{{/if}}{{/unless}} fa fa-bars"></span>
                    <span class="sr-only">Toggle navigation</span>
                </button>
				<a class="hidden-xs navbar-brand" href="/">{{settings.teamname}}</a>
				<div class="">
					{{#with sitePageHeader}}
						<div class="mobile-site-header no-overflow visible-xs">
							{{#if this.link}}
								<a href="{{this.link}}">
                                {{#if this.back}}
                                    {{this.back}}
                                {{else}}
                                    <span class="fa fa-home fa-lg"></span>
                                {{/if}}
                            </a>
								{{#if this.name}}
									<span class="fa fa-caret-right"></span>
									<span>
                                    {{this.name}}
                                </span>
								{{/if}}
							{{else}}
								<span>{{this.name}}</span>
							{{/if}}
						</div>
					{{/with}}
				</div>
			</div>
			<ul class="nav navbar-nav hidden-xs">
				{{>navLinks}}
			</ul>
		</div>
	</nav>
</template>
<template name="navLinks">
	{{#each settings.objectHeaderLinks.links}}
		{{#if showMenuEntry}}
			{{#if this.submenu}}
				<li class="dropdown {{../liClass}} {{#if isActive}}active{{/if}}">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        {{this.text}} <span class="caret"></span>
                    </a>
					<ul class="dropdown-menu" role="menu">
						{{#each this.submenu}}
							{{#if this.target}}
								<li><a href="{{this.target}}">{{this.text}}</a></li>
							{{else}}
								<li>
									<hr/>
								</li>
							{{/if}}
						{{/each}}
					</ul>
				</li>
			{{else}}
				<li class="{{../liClass}} {{#if isActive}}active{{/if}}"><a class="" href="{{this.target}}">{{this.text}}</a>
				</li>
			{{/if}}
		{{/if}}
	{{/each}}
</template>
<template name="sidebar">
	<div class="navigation-area sidebar">
		<div class="title" style="background-image:url('{{imageUrl settings.imageMobileLogo}}')">
		</div>
		<div class="title" style="background-color:rgba(0,0,0,0.5);position:absolute;top:0px;">
			<a class="title-link" href="{{pathFor route='/'}}">{{settings.siteTitle}}</a>
			<a class="sub-title-link" href="{{pathFor route='/'}}">{{settings.siteSubTitle}}</a>
			{{#unless meteorStatus.connected}}
				<span class="info-title text-warning">
                Keine Verbindung zum Server, einige Funktionen stehen evtl. nicht zur Verf√ºgung<br/>
                <button href="#" class="btn btn-link action-reconnect">Neu verbinden</button>
            </span>
			{{/unless}}
			{{#if currentUser}}
				<div class="user-header">
					<button class="btn btn-link toggle-user-menu" type="button">
                        <small>{{currentUser.profile.name}} ({{currentUser.username}})</small>
                        <span class="fa fa-caret-down"></span>
                    </button>
				</div>
			{{/if}}
		</div>

		{{#if currentUser}}
			<div class="list-group link-list">
				<a href="{{pathFor route='user' _id=currentUser._id }}" class="list-group-item {{#if isActive}}active{{/if}}">
                    Einstellungen
                </a>
				<a href="#" class="list-group-item action-logout">
                    Abmelden
                </a>
				<a href="#" class="list-group-item toggle-user-menu sublinks">
					<span class="fa fa-arrow-left"></span>
				</a>
			</div>
		{{/if}}
		<div class="list-group link-list visible-actions">
			{{#each settings.objectHeaderLinks.links}}
				{{#if showMenuEntry}}
					{{#if this.submenu}}
						<a href="#" class="list-group-item sublinks {{#if isActive}}active{{/if}}">
                        {{this.text}} <span class="caret"></span>
                    </a>
						<div class="submenu" role="menu" style="display:none">
							{{#each this.subLinks}}
								<a href="{{this.target}}" class="list-group-item">
                                {{this.text}}
                            </a>
							{{/each}}
						</div>
					{{else}}
						<a href="{{this.target}}" class="list-group-item {{#if isActive}}active{{/if}}">
                        {{this.text}}
                    </a>
					{{/if}}
				{{/if}}
			{{/each}}
			{{#if isAdmin}}
				<a href="{{pathFor route='admin'}}" class="list-group-item bg-{{this.style}}">
					<span class="fa fa-gears"></span> Admin
					{{#with AdminNotifications}}
						<span class="badge">{{this.count}}</span>
					{{/with}}
				</a>
			{{/if}}
		</div>
		<div class="footer list-group">
			<a class="list-group-item" href="{{pathFor route='wikipage' _id=settings.wikiImpressum}}">
				<span class="fa fa-justice"></span> Impressum
			</a>
			<div class="copyright-note list-group-item">
				<span class="fa fa-copyright"></span> {{settings.copyright_note}}
			</div>
		</div>
	</div>

</template>

<template name="userHeader">
	{{#if currentUser}}
		<div class="dropdown pull-right">
			<button class="btn navbar-btn btn-{{#unless meteorStatus.connected}}danger{{else}}{{#if AdminNotifications.count}}info{{else}}default{{/if}}{{/unless}} dropdown-toggle"
				type="button" id="dropdownUserMenu" data-toggle="dropdown" aria-expanded="true">
                <span class="fa fa-bars"></span>
            </button>
			<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownUserMenu">
				<li class="dropdown-header">
					{{currentUser.username}} ({{currentUser.profile.name}} {{currentUser.profile.surname}})
				</li>
				<li role="presentation">
					<a class="goto-user-profile" role="menuitem" tabindex="-1" href="{{pathFor route='user' _id=currentUser._id }}">
						<span class="fa fa-user"></span> Einstellungen
					</a>
				</li>
				<li role="presentation">
					<a class="action-logout" role="menuitem" tabindex="-1" href="#">
						<span class="fa fa-sign-out"></span> Abmelden
					</a>
				</li>
				{{#unless meteorStatus.connected}}
					<li role="separator" class="divider"></li>
					<li class="dropdown-header">
						Keine Verbindung zum Server!
					</li>
					<li>
						<a href="#" class="action-reconnect">
							<span class="fa fa-plug"></span> Neu verbinden
						</a>
					</li>
				{{/unless}}
				{{#if isAdmin}}
					<li role="separator" class="divider"></li>
					<li role="presentation">
						<a href="{{pathFor route='admin'}}">
                        {{#with AdminNotifications}}
                        <span class="badge pull-right">{{this.count}}</span>
                        {{/with}}
                        <span class="fa fa-gears"></span> Admin
                    </a>
					</li>
				{{/if}}
			</ul>
		</div>
	{{else}}
		<a href="{{pathFor route='login'}}" class="btn navbar-btn pull-right btn-primary btn-login-link {{#unless meteorStatus.connected}}disabled{{/unless}}">
			<span class="fa fa-user"></span> Anmelden
		</a>
	{{/if}}
</template>

<template name="content">
	{{> Template.dynamic template=template }}
</template>


<template name="footer">
	<div class="pull-right">
		<a href="{{pathFor route='wikipage' _id=settings.wikiImpressum}}">Impressum</a>
	</div>
	copyright by Lars Wolter
</template>